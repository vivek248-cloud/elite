{% extends 'index/base.html' %}
{% load static %}
{% load compress %}

{% block title %}Completed Construction Projects in Trichy | Elite Dream Builders{% endblock %}
{% block description %}Explore Elite Dream Builders’ completed and ongoing construction projects in Trichy, including residential homes, commercial buildings, and turnkey developments.{% endblock %}
{% block keywords %}construction projects in Trichy, completed house projects Trichy, commercial buildings Trichy, residential projects Trichy, Elite Dream Builders portfolio, turnkey projects Trichy{% endblock %}


  {% block content %}

    <div class="terms-head">
      <div class="terms-head-overlay"></div>
        <div class="content-wrapper animation fade-in">
          <h1 class="projects-title" >OUR SIGNATURE PROJECTS</h1>
          <p class="projects-subtitle">
            Crafted with precision, excellence, and timeless architectural elegance.
          </p>
        </div>
      </div>
    </div>
  <div class="projects">
      <div class="projects-text">
        <div class="section-title-wrapper" style="text-align:center;">
          <h1 class="section-title" >Our Projects</h1>  
        </div>

        <div class="intro animation slide-down">
          <p >
            At Elite Dream Builders, we focus on top-quality construction and timely delivery. Our strong client relationships and dedication to excellence make us one of the most trusted builders in Trichy.
          </p>
        </div>
      </div>


    <section class="completed-projects">
      <div class="section-title-wrapper">
        <h2 class="section-title" >Completed Projects</h2>
      </div>

      <div class="project-gallerys" id="projects-container">
      {% for project in projects %}
        <div class="project-tile">
          <a href="{% url 'projects_details' project.slug %}">
            <img src="{{ project.image.url }}" alt="{{ project.title }}" loading="lazy" decoding="async">
          </a>
          <div class="view-link">
            <a href="{% url 'projects_details' project.slug %}">View Project</a>
            <span class="circle-arrow">&#10140;</span> <!-- Unicode arrow matching your screenshot -->
          </div>
        </div>
          {% empty %}
          <p>No images available</p>
      {% endfor %}
      </div>

      <button id="load-more-btn" class="load-more-button" >Load More</button>
    </section>
    
<section class="completed-projects">
  <div class="section-title-wrapper">
    <h2 class="section-title">Ongoing Projects</h2>
  </div>

  <!-- embed a template for project detail links. 'SLUG' is literal placeholder -->
  <div class="project-gallerys"
       id="upcoming-projects-container"
       data-detail-template="{% url 'projects_details' 'SLUG' %}">
    {% for project in upcoming_projects %}
      <div class="project-tile">
        <a href="{% url 'projects_details' project.slug %}">
          <img src="{{ project.image.url }}" alt="{{ project.title }}" loading="lazy" decoding="async">
        </a>
        <div class="view-link">
          <a href="{% url 'projects_details' project.slug %}">View Project</a>
          <span class="circle-arrow">&#10140;</span>
        </div>
      </div>
    {% empty %}
      <p>No images available</p>
    {% endfor %}
  </div>

  <button id="load-more-upcoming-btn" class="load-more-button">Load More</button>
</section>


<section class="youtube-gallery-section">
  <h2 class="section-title" >Explore Our Projects</h2>

  <div id="youtube-video-grid" class="youtube-video-grid">
    {% for video in youtube_videos %}
      <div class="youtube-frame" >
        <div class="video-wrapper">
          <iframe 
            width="100%" 
            height="300" 
            src="https://www.youtube.com/embed/{{ video.youtube_link }}" 
            title="{{ video.title }}" 
            frameborder="0" 
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
            allowfullscreen>
          </iframe>
        </div>
      </div>
    {% endfor %}
  </div>
  <button id="load-more-youtube-video-btn" class="load-more-button" >Load More</button>
</section>



<!-- <section class="project-videos-section">
  <h2 class="section-title" >Client Video References</h2>
  
  <div id="project-videos-container" class="video-grid">
    {% for projectvideo in project_videos %}
      <div class="video_cards" >
        <video controls width="100%" autoplay loop muted>
         <source src="{{ projectvideo.secure_url }}" type="video/mp4" preload="auto">
          Your browser does not support the video tag.
        </video>
      </div>
    {% endfor %}

  </div>
  <button id="load-more-video-btn" class="load-more-button" >Load More</button>
</section> -->

{% comment %} /*youtube videos*/ {% endcomment %}
<script>
  document.addEventListener('DOMContentLoaded', () => {
    let youtubeOffset = 3;
    const loadMoreYouTubeBtn = document.getElementById('load-more-youtube-video-btn');
    const youtubeVideoGrid = document.getElementById('youtube-video-grid');
    const loadMoreYouTubeUrl = "/load-more-youtube-videos/";
  
    if (loadMoreYouTubeBtn && youtubeVideoGrid) {
      loadMoreYouTubeBtn.addEventListener('click', () => {
        fetch(`${loadMoreYouTubeUrl}?offset=${youtubeOffset}`)
          .then(response => response.json())
          .then(data => {
            data.videos.forEach(video => {
              const card = document.createElement('div');
              card.classList.add('youtube-frame', 'animation', 'fade-in-up');
              card.innerHTML = `
                <div class="video-wrapper">
                  <iframe 
                    width="100%" 
                    height="300" 
                    src="https://www.youtube.com/embed/${video.youtube_link}" 
                    title="${video.title}" 
                    frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                    allowfullscreen>
                  </iframe>
                </div>
                ${video.description ? `<p class="video-description">${video.description}</p>` : ''}
              `;
              youtubeVideoGrid.appendChild(card);
            });
  
            youtubeOffset += 3;
  
            if (!data.has_more) {
              loadMoreYouTubeBtn.style.display = 'none';
            }
          })
          .catch(error => {
            console.error('Error loading more YouTube videos:', error);
          });
      });
    }
  });
  
</script>


<section class="video-section" id="video-section">
  <a href="{% url "row_villa" %}">
  <video autoplay muted loop class="bg-video">
    <source src="https://pub-9c1665977a4c4135b3fd86b50e70cdfb.r2.dev/VN20250726_174431%20(1).mp4" type="video/mp4" rel="preload">
    Your browser does not support HTML5 video.
  </video>

  <div class="video-overlay"></div>
  <div class="mouse-tracker" id="mouseTracker">view</div>
  <div class="video-content">
    <h1 style="text-transform: uppercase;">Premium Row Villa</h1>
    <p style="text-transform: uppercase;">Ultra-Spacious 3BHK villa</p>
  </div>
  </a>
</section>
</div>

<section class="projects-section">
  <div class="container">
    <div class="projects-inner row align-items-center gy-4">

      <!-- LEFT: Headline & copy -->
      <div class="col-12 col-lg-7">
        <h2 class="projects-sub-title">Delivering Dreams with Integrity</h2>

        <div class="projects-body">
          <p>
            At <strong>The Elite Dream Builders</strong>, we deliver exceptional construction experiences built on transparency and discipline. We plan using precise Gantt schedules and monitor progress with our dedicated mobile app so you always know the status of your project.
          </p>

          <p>
            Every structure undergoes <strong>200+ quality checks</strong> to guarantee strength, safety and longevity. From premium villas and modern duplexes to stylish apartments — every design balances aesthetics, efficiency and cost.
          </p>

          <p class="mb-0">
            Currently active in <strong>Kalkandar Kottai, Ponamalipatty, Urayur</strong> and <strong>Srirangam</strong>, with more projects coming in Tiruvanaikovil. We focus on eco-conscious, energy-efficient solutions tailored to varied budgets and dreams.
          </p>
        </div>

        <div class="projects-ctas mt-4 d-flex flex-wrap gap-2">
          <a href="{% url 'projects' %}" class="btn view-project btn-lg">View Projects</a>
          <a href="{% url 'get_quote' %}" class="btn btn-outline-dark btn-lg">Get a Quote</a>
        </div>
      </div>

      <!-- RIGHT: Decorative image / stats -->
      <div class="col-12 col-lg-5">
        <div class="projects-card">
          <!-- Replace the src with a real project image or a local SVG -->
          <img src="{% static 'images/vasan-city.webp' %}" alt="Project preview" class="projects-image" loading="lazy" decoding="async">

          <div class="projects-stats">
            <div class="stat">
              <div class="stat-value">20+</div>
              <div class="stat-label">Quality checks</div>
            </div>
            <div class="stat">
              <div class="stat-value">4.6★</div>
              <div class="stat-label">Average rating</div>
            </div>
            <div class="stat">
              <div class="stat-value">100+</div>
              <div class="stat-label">Happy clients</div>
            </div>
          </div>
        </div>
      </div>

    </div><!-- /.projects-inner -->
  </div><!-- /.container -->
</section>





{% endblock %}

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.0/js/bootstrap.bundle.min.js"></script>
{% compress js %}
    <script src="{% static "js/elite.js" %}"></script>
{% endcompress %}

    {% block extra_js %}
    <script>
      function isInViewport(element) {
        const rect = element.getBoundingClientRect();
        return (
            rect.top < window.innerHeight && rect.bottom > 0 &&
            rect.left < window.innerWidth && rect.right > 0
        );
    }
    
    function animateOnScroll() {
        const elements = document.querySelectorAll('.animation');
        elements.forEach(element => {
            if (isInViewport(element) && !element.classList.contains('show')) {
                element.classList.add('show');
                element.getBoundingClientRect(); // Force repaint
            }
        });
    }
    
    function optimizedScroll() {
        requestAnimationFrame(animateOnScroll);
    }
    
    document.addEventListener('DOMContentLoaded', animateOnScroll);
    window.addEventListener('scroll', optimizedScroll);


    
    window.addEventListener("load", function () {
      document.getElementById("loader").style.display = "none";
    });
    
    setTimeout(() => {
      document.getElementById("loader").style.display = "none";
  }, 3000); // Hides loader after 5 seconds    
  
  </script>

<script>
    let offset = 12; // First 12 are already loaded initially
    const limit = 6; // Match with Django's view
    const loadMoreUrl = "{% url 'load_more_projects' %}";

    document.getElementById('load-more-btn').addEventListener('click', () => {
        fetch(`${loadMoreUrl}?offset=${offset}`)
            .then(response => response.json())
            .then(data => {
                const container = document.getElementById('projects-container');
                data.projects.forEach(project => {
                    const card = document.createElement('div');
                    card.classList.add('project-tile');
                    card.innerHTML = `
                        <a href="/projects/${project.slug}/">
                            <img src="${project.image_url}" alt="${project.title}">
                        </a>
                        <div class="view-link">
                            <a href="/projects/${project.slug}/">View Project</a>
                            <span class="circle-arrow">&#10140;</span>
                        </div>
                    `;
                    container.appendChild(card);
                });

                offset += limit; // ✅ increment by the same amount fetched

                if (!data.has_more) {
                    document.getElementById('load-more-btn').style.display = 'none';
                }
            })
            .catch(error => {
                console.error('Error loading more projects:', error);
            });
    });
</script>


{% comment %} upcomming projects {% endcomment %}

<script>
  (function() {
    const container = document.getElementById('upcoming-projects-container');
    const loadBtn = document.getElementById('load-more-upcoming-btn');

    // compute offset from DOM so it matches what the server already rendered
    let upcomingOffset = container.querySelectorAll('.project-tile').length || 0;
    const defaultLimit = 6;

    // URL from Django template (contains literal 'SLUG' placeholder)
    const detailTemplate = container.dataset.detailTemplate || '/projects/SLUG/';

    // Load-more endpoint (resolved by Django)
    const loadMoreUpcomingUrl = "{% url 'load_more_upcomming_projects' %}";

    function makeProjectCard(project) {
      const card = document.createElement('div');
      card.classList.add('project-tile');

      // replace placeholder in the detail url
      const detailUrl = detailTemplate.replace('SLUG', project.slug);

      // if no image_url, you can put a placeholder or omit the img tag
      const imgHtml = project.image_url
        ? `<a href="${detailUrl}"><img src="${project.image_url}" alt="${escapeHtml(project.title)}" loading="lazy" decoding="async"></a>`
        : `<a href="${detailUrl}"><div class="no-image">No image</div></a>`;

      card.innerHTML = `
        ${imgHtml}
        <div class="view-link">
          <a href="${detailUrl}">View Project</a>
          <span class="circle-arrow">&#10140;</span>
        </div>
      `;
      return card;
    }

    // small helper to escape text inserted into attributes (optional but safer)
    function escapeHtml(text) {
      return (text + '')
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }

    loadBtn.addEventListener('click', () => {
      loadBtn.disabled = true;
      loadBtn.textContent = 'Loading...';

      const url = `${loadMoreUpcomingUrl}?offset=${upcomingOffset}&limit=${defaultLimit}`;

      fetch(url)
        .then(res => {
          if (!res.ok) throw new Error('Network response was not ok: ' + res.status);
          return res.json();
        })
        .then(data => {
          if (!data || !Array.isArray(data.upcoming_projects)) {
            throw new Error('Unexpected JSON format');
          }

          data.upcoming_projects.forEach(project => {
            const card = makeProjectCard(project);
            container.appendChild(card);
          });

          // update offset using returned new_offset if provided, otherwise add limit
          if (typeof data.new_offset === 'number') {
            upcomingOffset = data.new_offset;
          } else {
            upcomingOffset += data.upcoming_projects.length;
          }

          if (!data.has_more) {
            loadBtn.style.display = 'none';
          } else {
            loadBtn.disabled = false;
            loadBtn.textContent = 'Load More';
          }
        })
        .catch(err => {
          console.error('Error loading more upcoming projects:', err);
          // restore button state
          loadBtn.disabled = false;
          loadBtn.textContent = 'Load More';
          // optionally show a user-visible error
          // alert('Unable to load more projects. Check your connection or try again.');
        });
    });
  })();
</script>


{% comment %} project videos {% endcomment %}

<!-- <script>
  let videoOffset = 3; // Start from 3 if 3 are loaded initially
  const loadMoreVideosUrl = "{% url 'load_more_projects_videos' %}";

  document.getElementById('load-more-video-btn').addEventListener('click', () => {
      fetch(`${loadMoreVideosUrl}?offset=${videoOffset}`)
          .then(response => response.json())
          .then(data => {
              const container = document.getElementById('project-videos-container');
              data.projects.forEach(video => {
                  const card = document.createElement('div');
                  card.classList.add('video_cards', 'animation', 'zoom-in');
                  card.innerHTML = `
                      <video controls width="100%">
                          <source src="${video.video_file}" type="video/mp4">
                          Your browser does not support the video tag.
                      </video>
                      
                  `;
                  container.appendChild(card);
              });

              videoOffset += 3;

              if (!data.has_more) {
                  document.getElementById('load-more-video-btn').style.display = 'none';
              }
          })
          .catch(error => {
              console.error('Error loading more project videos:', error);
          });
  });
</script> -->
{% endblock %}
